---
import { getLangFromUrl, useTranslations } from '@/i18n/utils';

const lang = getLangFromUrl(Astro.url);
const t = useTranslations(lang);

// Generate current month and year for discount code
const now = new Date();
const monthNames = {
  es: ['ENERO', 'FEBRERO', 'MARZO', 'ABRIL', 'MAYO', 'JUNIO', 
       'JULIO', 'AGOSTO', 'SEPTIEMBRE', 'OCTUBRE', 'NOVIEMBRE', 'DICIEMBRE'],
  en: ['JANUARY', 'FEBRUARY', 'MARCH', 'APRIL', 'MAY', 'JUNE',
       'JULY', 'AUGUST', 'SEPTEMBER', 'OCTOBER', 'NOVEMBER', 'DECEMBER']
};

const currentMonth = monthNames[lang][now.getMonth()];
const currentYear = now.getFullYear();
const discountCode = `${currentMonth}${currentYear}`;
---

<div 
  id="discount-banner" 
  class="bg-brand-light text-brand-dark text-center py-2 sm:py-2 md:h-9 min-h-[36px] flex items-center justify-center fixed top-0 left-0 right-0 z-50 transition-transform duration-300 ease-in-out"
>
  <div class="max-w-7xl mx-auto px-2 sm:px-4 lg:px-8 w-full">
    <p class="text-xs sm:text-sm font-medium font-gotham leading-tight">
      {lang === 'es' ? (
        <>
          <span class="block sm:inline">Este mes, ahorre <span class="font-bold">$1250</span> con el c√≥digo: <span class="font-bold bg-white text-brand-dark px-1 sm:px-2 py-1 rounded mx-1 inline-block">{discountCode}</span></span>
          <span class="block sm:inline mt-1 sm:mt-0">Llame hoy mismo al <span class="font-bold">+51 928-105-750</span>.</span>
        </>
      ) : (
        <>
          <span class="block sm:inline">This month, save <span class="font-bold">$1250</span> with code: <span class="font-bold bg-white text-brand-dark px-1 sm:px-2 py-1 rounded mx-1 inline-block">{discountCode}</span></span>
          <span class="block sm:inline mt-1 sm:mt-0">Call <span class="font-bold">+51 928-105-750</span> today.</span>
        </>
      )}
    </p>
  </div>
</div>

<script>
  // Scroll behavior for discount banner
  let lastScrollTop = 0;
  let isScrolling = false;
  
  const banner = document.getElementById('discount-banner');
  if (banner) {
    // Add padding to body to account for fixed banner
    document.body.style.paddingTop = '36px';
    
    window.addEventListener('scroll', () => {
      if (!isScrolling) {
        window.requestAnimationFrame(() => {
          const scrollTop = window.pageYOffset || document.documentElement.scrollTop;
          
          if (scrollTop > lastScrollTop && scrollTop > 50) {
            // Scrolling down - hide banner
            banner.style.transform = 'translateY(-100%)';
          } else {
            // Scrolling up or at top - show banner
            banner.style.transform = 'translateY(0)';
          }
          
          lastScrollTop = scrollTop;
          isScrolling = false;
        });
      }
      isScrolling = true;
    });
  }
</script>
