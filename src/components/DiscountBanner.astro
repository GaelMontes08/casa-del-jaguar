---
import { getLangFromUrl, useTranslations } from '@/i18n/utils';

const lang = getLangFromUrl(Astro.url);
const t = useTranslations(lang);

const now = new Date();
const monthNames = {
  es: ['ENERO', 'FEBRERO', 'MARZO', 'ABRIL', 'MAYO', 'JUNIO', 
       'JULIO', 'AGOSTO', 'SEPTIEMBRE', 'OCTUBRE', 'NOVIEMBRE', 'DICIEMBRE'],
  en: ['JANUARY', 'FEBRUARY', 'MARCH', 'APRIL', 'MAY', 'JUNE',
       'JULY', 'AUGUST', 'SEPTEMBER', 'OCTOBER', 'NOVEMBER', 'DECEMBER']
};

const currentMonth = monthNames[lang][now.getMonth()];
const currentYear = now.getFullYear();
const discountCode = `${currentMonth}${currentYear}`;
---

<div 
  id="discount-banner" 
  class="bg-brand-light text-brand-dark text-center discount-banner flex items-center justify-center relative z-50 transition-all duration-300 ease-in-out"
>
  <div class="w-full max-w-[1920px] mx-auto px-2 sm:px-4 lg:px-8">
    <div class="text-xs sm:text-sm font-medium font-gotham leading-tight py-2">
      {lang === 'es' ? (
        <>
          <div class="block sm:inline">Este mes, ahorre <span class="font-bold">$800</span> con el c√≥digo: <span class="font-bold bg-white text-brand-dark px-1 sm:px-2 py-1 rounded mx-1 inline-block">{discountCode}</span></div>
          <div class="block sm:inline mt-1 sm:mt-0">Llame hoy mismo al <span class="font-bold">+51 928-230-781</span>.</div>
        </>
      ) : (
        <>
          <div class="block sm:inline">This month, save <span class="font-bold">$800</span> with code: <span class="font-bold bg-white text-brand-dark px-1 sm:px-2 py-1 rounded mx-1 inline-block">{discountCode}</span></div>
          <div class="block sm:inline mt-1 sm:mt-0">Call <span class="font-bold">+51 928-230-781</span> today.</div>
        </>
      )}
    </div>
  </div>
</div>

<script>
  // Scroll behavior for discount banner
  let lastScrollTop = 0;
  let isScrolling = false;
  
  const banner = document.getElementById('discount-banner');
  const header = document.getElementById('main-header');
  
  if (banner && header) {
    // Get banner height for calculations
    const getBannerHeight = () => banner.getBoundingClientRect().height;
    
    window.addEventListener('scroll', () => {
      if (!isScrolling) {
        window.requestAnimationFrame(() => {
          const scrollTop = window.pageYOffset || document.documentElement.scrollTop;
          const bannerHeight = getBannerHeight();
          
          if (scrollTop > lastScrollTop && scrollTop > 50) {
            // Scrolling down - hide banner
            banner.style.transform = 'translateY(-100%)';
            banner.style.position = 'fixed';
            banner.style.top = '0';
            banner.style.left = '0';
            banner.style.right = '0';
            banner.style.zIndex = '50';
            
            // Header sticks to top when banner is hidden
            header.style.top = '0';
          } else {
            // Scrolling up or at top - show banner
            banner.style.transform = 'translateY(0)';
            
            if (scrollTop <= 50) {
              // Return to normal block position when near top
              banner.style.position = 'relative';
              banner.style.top = 'auto';
              banner.style.left = 'auto';
              banner.style.right = 'auto';
              
              // Header should be pushed down by banner height
              header.style.top = 'auto';
            } else {
              // Keep fixed position when scrolling up but not at top
              banner.style.position = 'fixed';
              banner.style.top = '0';
              banner.style.left = '0';
              banner.style.right = '0';
              banner.style.zIndex = '50';
              
              // Header should stick below the banner
              header.style.top = `${bannerHeight}px`;
            }
          }
          
          lastScrollTop = scrollTop;
          isScrolling = false;
        });
      }
      isScrolling = true;
    });
    
    // Initial setup
    const initialBannerHeight = getBannerHeight();
    if (window.pageYOffset <= 50) {
      header.style.top = 'auto';
    }
  }
</script>

<style>
  .discount-banner {
    min-height: 64px; /* Mobile: 4rem */
    height: auto;
  }
  
  @media (min-width: 640px) {
    .discount-banner {
      min-height: 48px; /* Tablet: 3rem */
    }
  }
  
  @media (min-width: 768px) {
    .discount-banner {
      min-height: 36px; /* Desktop: 2.25rem */
      height: 36px;
    }
  }
</style>
